<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>H.y's Blog</title>
	<meta name="description" content="">
	<meta name="author" content="hyhx2008">

	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="http://hyhx2008.github.com/theme/html5.js"></script>
	<![endif]-->

	<!-- Le styles -->
	<link href="http://hyhx2008.github.com/theme/bootstrap.min.css" rel="stylesheet">
	<link href="http://hyhx2008.github.com/theme/local.css" rel="stylesheet">
	<link href="http://hyhx2008.github.com/theme/pygments.css" rel="stylesheet">
	<script>var _gaq=[['_setAccount','UA-36075477-1'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>
	<script type="text/javascript">
	var disqus_identifier = "tesseract-ocrshi-yong-fang-fa-zong-jie.html";
	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = 'http://hysblog.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
		
	<link rel="shortcut icon" href="http://hyhx2008.github.com/theme/images/icons/icon1.png">
</head>
<body>
		<a href="https://github.com/hyhx2008"><img style="position: absolute; top: 39px; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png" alt="Fork me on GitHub" /></a>
	<div class="topbar">
	  <div class="topbar-inner">
		<div class="container-fluid">
		  <a class="brand" href="http://hyhx2008.github.com/index.html">H.y's Blog</a>
			<ul class="nav">
																										<li ><a href="http://hyhx2008.github.com/category/ItA.html">ItA</a></li>
									<li class="active"><a href="http://hyhx2008.github.com/category/intern.html">intern</a></li>
									<li ><a href="http://hyhx2008.github.com/category/my.html">my</a></li>
									<li ><a href="http://hyhx2008.github.com/category/peersim.html">peersim</a></li>
									<li ><a href="http://hyhx2008.github.com/category/tech.html">tech</a></li>
									<li ><a href="http://hyhx2008.github.com/category/ubuntu.html">ubuntu</a></li>
							</ul>
			<p class="pull-right"><a href="http://hyhx2008.github.com/archives.html">[archives]</a> <a href="http://hyhx2008.github.com/tags.html">[tags]</a></p>
		</div>
	  </div>
	</div>

	<div class="container-fluid">	
	  <div class="span5 sidebar">
		<div class="well">
			<h3>Blogroll</h3>
			<ul>
								<li><a href="http://x-wei.github.com">x-wei</a></li>
								<li><a href="http://farseerfc.github.com/">farseerfc</a></li>
							</ul>
			<div class="social">
			<h3>Social</h3>
			<ul>
								<li><a href="https://github.com/hyhx2008">github</a></li>
							</ul>
			</div>
			
		</div>
		
		<div class="well">
			<div class="search_sidebar">
				<li class="nav-header"><h4><i class="icon-search"></i>Google Search</h4></li>
<!-- Put the following javascript before the closing </head> tag. -->
<script>
  (function() {
    var cx = '007947589229995882978:padodsakamc';
    var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
  })();
</script>
<!-- Place this tag where you want both of the search box and the search results to render -->
<gcse:search></gcse:search>
			</div>

			<div class="google_ads">
				<li class="nav-header"><h4><i class="icon-search"></i>Google Ads</h4></li>
<script type="text/javascript"><!--
google_ad_client = "ca-pub-5617943900713834";
/* HY&#39;s github blog */
google_ad_slot = "7280262031";
google_ad_width = 160;
google_ad_height = 600;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
			</div>
		</div>

	  </div>
	  <div class="content">
							<div class='article'>
		<div class="page-header"><h1>tesseract-ocr使用方法总结</h1></div>
		<div class="well small">Permalink: <a class="more" href="http://hyhx2008.github.com/tesseract-ocrshi-yong-fang-fa-zong-jie.html">2012-12-01 16:34:00</a>
by <a class="url fn" href="http://hyhx2008.github.com/author/hyhx2008.html">hyhx2008</a>in <a href="http://hyhx2008.github.com/category/intern.html">intern</a>
tags: <a href="http://hyhx2008.github.com/tag/ocr Linux.html">ocr Linux</a> </div>
		<div><p>实习的时候接触到了一个挺不错的OCR(光学字符识别)工具tesseract，这里总结一下linux下tesseract的简单用法。</p>
<p>tesseract-ocr是由google维护的一个开源ocr库，可以识别多种格式图片中的文字，可以直接作为一个工具使用，也可以利用tesseract提供的api在自己的程序中使用ocr功能。</p>
<p><a class="reference external" href="http://code.google.com/p/tesseract-ocr/">项目主页</a></p>
<p><strong>1.tesseract-ocr安装</strong></p>
<p>ubuntu和debian下tesseract的安装非常简单，但是需要安装的包比较多:</p>
<div class="highlight"><pre><span class="gp">$</span>sudo aptitude install tesseract-ocr tesseract-ocr-dev tesseract-ocr-eng
</pre></div>
<p>tesseract-ocr即为ocr库，tesseract-ocr-dev是使用api时需要用到的头文件。</p>
<p>tesseract-ocr-eng是语言包，这里安装的是英文，如果要识别其他语言，需要安装其他语言包。</p>
<p>（语言包安装的位置在/usr/share/tesseract-ocr/tessdata/，该位置将作为初始化api的一个参数）</p>
<p>为了识别tiff格式的图片，最好再安装以下两个库:</p>
<div class="highlight"><pre><span class="gp">$</span>sudo aptitude install leptonica libtiff
</pre></div>
<p>这样tesseract-ocr和一些相关的包就安装完成了。</p>
<p><strong>2.tesseract-ocr使用</strong></p>
<p>作为一个命令行程序，tesseract可以用以下命令识别一张图片中的文字:</p>
<div class="highlight"><pre><span class="go">tesseract photo.tif 1.txt</span>
</pre></div>
<p>以上命令将从photo.tif中识别的文字存储在1.txt中。</p>
<p><strong>3.tesseract api 使用</strong></p>
<p>tesseract现在已经出到3.0.1版本了，网上的资料也大多基于3.0.1版本，比如
<a class="reference external" href="http://www.cnblogs.com/zsb517/archive/2012/06/06/2537540.html">Tesseract3.01在VS2008下面的使用</a> 和
<a class="reference external" href="http://blog.csdn.net/foxwit/article/details/6547465">OCR识别引擎tesseract使用方法</a> 。</p>
<p>不幸的是，Debian下安装的是2.0.4版本，api的命名与用法和新版本有所不同。在项目主页上我也没有找到api的使用手册之类的东西，只能自己琢磨。</p>
<p>我发现查看tesseract的source code是一个很好的学习api用法的途径，源码可以在下面的链接中下载:
<a class="reference external" href="http://code.google.com/p/tesseract-ocr/downloads/detail?name=tesseract-2.04.tar.gz&amp;can=2&amp;q=">tesseract 2.0.4 Source</a>
，
<a class="reference external" href="http://code.google.com/p/tesseract-ocr/downloads/detail?name=tesseract-3.01.tar.gz&amp;can=2&amp;q=">tesseract 3.0.1 Source</a>
。</p>
<p>下载并解压后在ccmain文件夹中的
<strong>tesseractmain.cpp</strong>
就是tesseract工具的主程序，是很好的api用法参考。api的声明在
<strong>baseapi.h</strong>
中(ccmain中或/usr/include下都可以找到)。</p>
<p>所有需要include的头文件都在 /usr/include/tesseract 和 /usr/include/lptonica 中，需要链接的库在/usr/lib中。</p>
<p>api的具体用法参见后面附的源码的注释。</p>
<p>编译真的是最痛苦的事情，不清楚需要链接哪些库，于是/usr/lib里用下面的命令找到相关的库，全都链接进来:</p>
<div class="highlight"><pre><span class="gp">$</span>ls | grep tesseract
<span class="gp">$</span>ls | grep leptonica
<span class="gp">$</span>ls | grep tiff
</pre></div>
<p>结果编译还是不通过，提示一大堆未定义的函数，发现都和png有关系，于是又用</p>
<div class="highlight"><pre><span class="gp">$</span>ls | grep png
</pre></div>
<p>找到一个库链接后才编译成功。我编译用的Makefile附在最后。</p>
<p><strong>4.api使用的例子</strong></p>
<p>新建一个ocr_test.cpp文件，将下面的代码粘贴进去即可。</p>
<div class="highlight"><pre><span class="cp">#include &lt;mfcpch.h&gt;</span>
<span class="cp">#include &lt;ctype.h&gt;</span>
<span class="cp">#include &quot;applybox.h&quot;</span>
<span class="cp">#include &quot;control.h&quot;</span>
<span class="cp">#include &quot;tessvars.h&quot;</span>
<span class="cp">#include &quot;tessedit.h&quot;</span>
<span class="cp">#include &quot;baseapi.h&quot;</span>
<span class="cp">#include &quot;pageres.h&quot;</span>
<span class="cp">#include &quot;imgs.h&quot;</span>
<span class="cp">#include &quot;varabled.h&quot;</span>
<span class="cp">#include &quot;tprintf.h&quot;</span>
<span class="cp">#include &quot;stderr.h&quot;</span>
<span class="cp">#include &quot;notdll.h&quot;</span>
<span class="cp">#include &quot;mainblk.h&quot;</span>
<span class="cp">#include &quot;output.h&quot;</span>
<span class="cp">#include &quot;globals.h&quot;</span>
<span class="cp">#include &quot;blread.h&quot;</span>
<span class="cp">#include &quot;tfacep.h&quot;</span>
<span class="cp">#include &quot;callnet.h&quot;</span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span><span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">){</span>

    <span class="k">if</span><span class="p">(</span><span class="n">argc</span><span class="o">!=</span><span class="mi">3</span><span class="p">)</span>
        <span class="p">{</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;usage:%s &lt;tiff file&gt; &lt;txt file&gt;/n&quot;</span><span class="p">,</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">char</span> <span class="o">*</span><span class="n">image_file</span><span class="o">=</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>       <span class="c1">//程序的第一个参数为图片路径</span>
        <span class="kt">char</span> <span class="o">*</span><span class="n">txt_file</span><span class="o">=</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>         <span class="c1">//第二个参数为保存识别出的字符的文件路径</span>

        <span class="n">STRING</span> <span class="n">text_out</span><span class="p">;</span>                        <span class="c1">//存储识别出的字符</span>

        <span class="n">TessBaseAPI</span>  <span class="n">api</span><span class="p">;</span>
        <span class="n">IMAGE</span> <span class="n">image</span><span class="p">;</span>

        <span class="n">api</span><span class="p">.</span><span class="n">SimpleInit</span><span class="p">(</span><span class="s">&quot;/usr/share/tesseract-ocr/tessdata/&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span> <span class="c1">// 初始化函数，tesseract还提供其他的初始化函数 参考 baseapi.h</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">read_header</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;read image header error!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
                <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">get_ysize</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;read image error!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
                <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="c1">//读取图片并判断是否读取成功</span>

        <span class="kt">int</span> <span class="n">bytes_per_line</span> <span class="o">=</span> <span class="n">check_legal_image_size</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">get_xsize</span><span class="p">(),</span><span class="n">image</span><span class="p">.</span><span class="n">get_ysize</span><span class="p">(),</span><span class="n">image</span><span class="p">.</span><span class="n">get_bpp</span><span class="p">());</span>

        <span class="kt">char</span><span class="o">*</span> <span class="n">text</span> <span class="o">=</span> <span class="n">api</span><span class="p">.</span><span class="n">TesseractRect</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">get_buffer</span><span class="p">(),</span><span class="n">image</span><span class="p">.</span><span class="n">get_bpp</span><span class="p">()</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span><span class="n">bytes_per_line</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">image</span><span class="p">.</span><span class="n">get_xsize</span><span class="p">(),</span><span class="n">image</span><span class="p">.</span><span class="n">get_ysize</span><span class="p">());</span>
        <span class="c1">//tesseract核心api，通过该函数识别出图片中的字符</span>

        <span class="n">text_out</span> <span class="o">+=</span> <span class="n">text</span><span class="p">;</span>

        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;output: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

        <span class="k">delete</span> <span class="p">[]</span> <span class="n">text</span><span class="p">;</span>

        <span class="kt">FILE</span><span class="o">*</span> <span class="n">fout</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">txt_file</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">);</span>

        <span class="n">fwrite</span><span class="p">(</span><span class="n">text_out</span><span class="p">.</span><span class="n">string</span><span class="p">(),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">text_out</span><span class="p">.</span><span class="n">length</span><span class="p">(),</span> <span class="n">fout</span><span class="p">);</span>

        <span class="n">fclose</span><span class="p">(</span><span class="n">fout</span><span class="p">);</span>

        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p><strong>5.编译并运行</strong></p>
<p>新建Makefile如下所示。</p>
<div class="highlight"><pre><span class="go">LDFLAGS= -ltesseract_full -ltesseract_pageseg -ltesseract_training -ltesseract_textord -ltesseract_wordrec -ltesseract_classify -ltesseract_dict -ltesseract_ccstruct -ltesseract_cutil -ltesseract_viewer -ltesseract_ccutil -ltesseract_image -ltesseract_main -llept -ltiff -ltiffxx -lpthread -lpng -lpng12</span>

<span class="go">INCLUDES= -I/usr/include/tesseract/ -I/usr/include/leptonica/</span>

<span class="go">all:ocr</span>

<span class="go">ocr:</span>
<span class="go">        g++ -g -o ocr ocr_test.cpp $(LDFLAGS) $(INCLUDES)</span>

<span class="go">clean:</span>
<span class="go">        rm ocr</span>
</pre></div>
<p>用下面的命令运行样例程序:</p>
<div class="highlight"><pre><span class="gp">$</span>make
<span class="gp">$</span>ocr photo.tif 1.txt
</pre></div>
<p>The End!!</p>
</div>
		<div>
			<h2>Comments</h2>
		 				<div id="disqus_thread"></div>					<div>
	</div>	
		<footer>
		  <p> Powered by <a href="http://alexis.notmyidea.org/pelican/">Pelican</a>, theme based on <a href="http://twitter.github.com/bootstrap/">Bootstrap, from Twitter</a>.</p>
		  <p>&copy; hyhx2008 2011</p>
		</footer>
	  </div>
   
	</div>
</body>
</html>