<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>H.y's Blog</title>
	<meta name="description" content="">
	<meta name="author" content="hyhx2008">

	<!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="./theme/html5.js"></script>
	<![endif]-->

	<!-- Le styles -->
	<link href="./theme/bootstrap.min.css" rel="stylesheet">
	<link href="./theme/local.css" rel="stylesheet">
	<link href="./theme/pygments.css" rel="stylesheet">
	
<script>var _gaq=[['_setAccount','UA-36075477-1'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>

	
<script type="text/javascript">
	var disqus_identifier = "trace-cmdyu-kernelsharkshi-yong-zong-jie.html";
	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = 'http://hysblog.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>

	
</head>
<body>
	
	
<a href="https://github.com/hyhx2008"><img style="position: absolute; top: 39px; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png" alt="Fork me on GitHub" /></a>

	<div class="topbar">
	  <div class="topbar-inner">
		<div class="container-fluid">
		  <a class="brand" href="./index.html">H.y's Blog</a>
			<ul class="nav">
				
				
					
				
				
					<li class="active"><a href="./category/intern.html">intern</a></li>
				
					<li ><a href="./category/my.html">my</a></li>
				
					<li ><a href="./category/tech.html">tech</a></li>
				
			</ul>
			<p class="pull-right"><a href="./archives.html">[archives]</a> <a href="./tags.html">[tags]</a></p>
		</div>
	  </div>
	</div>

	<div class="container-fluid">	
	  <div class="sidebar">
		<div class="well">
			<h3>Blogroll</h3>
			<ul>
				
				<li><a href="http://x-wei.github.com">x-wei</a></li>
				
				<li><a href="http://farseerfc.github.com/">farseerfc</a></li>
				
			</ul>
			<div class="social">
			<h3>Social</h3>
			<ul>
				
				<li><a href="https://github.com/hyhx2008">github</a></li>
				
			</ul>
			</div>
		</div>
		<div class="span3 well sidebar-nav" id="sidebar">
            
<li class="nav-header"><h4><i class="icon-search"></i>Google Search</h4></li>
<div id="cse" style="width: 100%;">Loading</div>
<script src="http://www.google.com/jsapi" type="text/javascript"></script>
<script type="text/javascript"> 
  google.load('search', '1');
  google.setOnLoadCallback(function() {
    var customSearchOptions = {};  var customSearchControl = new google.search.CustomSearchControl(
      '007947589229995882978:padodsakamc', customSearchOptions);
    customSearchControl.setResultSetSize(google.search.Search.SMALL_RESULTSET);
    customSearchControl.draw('cse');
  }, true);
</script>
<link rel="stylesheet" href="http://www.google.com/cse/style/look/default.css" type="text/css" />

        </div>
	  </div>
	  <div class="content">
			
			
	<div class='article'>
		<div class="page-header"><h1>trace-cmd与kernelshark使用总结</h1></div>
		<div class="well small">Permalink: <a class="more" href="./trace-cmdyu-kernelsharkshi-yong-zong-jie.html">2012-07-22 22:00:00</a>
by <a class="url fn" href="./author/hyhx2008.html">hyhx2008</a>
in <a href="./category/intern.html">intern</a>
tags: <a href="./tag/trace-cmd.html">trace-cmd</a> <a href="./tag/kernelshark.html">kernelshark</a> </div>
		<div><p><strong>1.trace-cmd</strong></p>
<p>trace-cmd是对ftrace的封装，是一个可以用来跟踪linux内核中事件(event)发生的时间、次数等的工具。</p>
<p>首先需要安装trace-cmd:</p>
<div class="highlight"><pre><span class="gp">$</span>sudo aptitude install trace-cmd
</pre></div>
<p>使用也非常简单:</p>
<div class="highlight"><pre><span class="gp">$</span>sudo trace-cmd record -e sched_switch
</pre></div>
<p>-e 参数指出需要跟踪的事件，这里的sched_switch指的是进程切换，还可以是hrtimer、irq等，例如:</p>
<div class="highlight"><pre><span class="gp">$</span>sudo trace-cmd record -e sched_switch -e hrtimer*
</pre></div>
<p>命令输完回车后，trace-cmd就开始记录内核中事件的发生了，ctrl+C 停止跟踪，此时会生成一个trace.dat文件，相当于一个log吧。</p>
<p>trace.dat里的内容不易读，trace-cmd提供分析trace.dat的功能:</p>
<div class="highlight"><pre><span class="gp">$</span>trace-cmd report
</pre></div>
<p>就可以看到所跟踪的事件发生的情况了，和下图差不多。</p>
<div class="figure">
<img alt="../statics/pics/trace_cmd_kernelshark1.png" src="statics/pics/trace_cmd_kernelshark1.png" />
</div>
<p>也可以重定向到一个文本文件中再做分析，比如:</p>
<div class="highlight"><pre><span class="gp">$</span>trace-cmd report &gt; report.txt
</pre></div>
<p>跟踪的报告就存入report.txt中了，可以用Perl等来处理。</p>
<p>注:使用trace-cmd需要内核开启ftrace，即在编译内核make menuconfig时，选择下面的选项:</p>
<p>Kernel Hacking -&gt; Tracers -&gt; Kernel Function Tracer</p>
<p><strong>2.kernelshark</strong></p>
<p>kernelshark提供了对trace.dat的可视化分析，首先安装:</p>
<div class="highlight"><pre><span class="gp">$</span>sudo aptitude install kernelshark
</pre></div>
<p>然后在trace.dat所在的目录输入:</p>
<div class="highlight"><pre><span class="gp">$</span>kernelshark
</pre></div>
<p>即可看到图形化界面了:</p>
<div class="figure">
<img alt="../statics/pics/trace_cmd_kernelshark2.png" src="statics/pics/trace_cmd_kernelshark2.png" />
</div>
<p>The End!!</p>
</div>
		<div>
			<h2>Comments</h2>
		 	
			<div id="disqus_thread"></div>
			
		<div>
	</div>	

		<footer>
		  <p> Powered by <a href="http://alexis.notmyidea.org/pelican/">Pelican</a>, theme based on <a href="http://twitter.github.com/bootstrap/">Bootstrap, from Twitter</a>.</p>
		  <p>&copy; hyhx2008 2011</p>
		</footer>
	  </div>
   
	</div>
</body>
</html>